"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ CSV
–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–∞–±–ª–∏—Ü—ã WeDrink
"""
import asyncio
import sys
from database import Database
from utils.import_csv import import_products_from_csv, import_stock_from_csv


async def main():
    """–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö"""
    # –ü—É—Ç—å –∫ CSV —Ñ–∞–π–ª—É
    csv_path = "/Users/Dom/Downloads/WeDrink - –ó–∞–∫—É–ø—ã.csv"

    print("üöÄ –ù–∞—á–∞–ª–æ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö...\n")

    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
    db = Database("wedrink.db")
    await db.init_db()

    # 1. –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤
    print("üì¶ –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤...")
    imported_products = await import_products_from_csv(csv_path, db)
    print(f"‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {imported_products}\n")

    if imported_products == 0:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç CSV —Ñ–∞–π–ª–∞.")
        return

    # 2. –ò–º–ø–æ—Ä—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤
    print("üìä –ò–º–ø–æ—Ä—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤...")

    # –ö–æ–ª–æ–Ω–∫–∏ —Å –≤–µ—Å–æ–º –¥–ª—è –∫–∞–∂–¥–æ–π –¥–∞—Ç—ã –∏–∑ –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü—ã
    # –§–æ—Ä–º–∞—Ç: {–¥–∞—Ç–∞: –Ω–æ–º–µ—Ä_–∫–æ–ª–æ–Ω–∫–∏}
    # –í CSV: –∫–æ–ª–æ–Ω–∫–∞ 8 = 17.11, 10 = 19.11, 12 = 20.11, 14 = 22.11, 16 = 23.11, 18 = 28.11
    date_columns = {
        "2024-11-17": 8,   # "–û–±—â–∏–π –≤–µ—Å" –¥–ª—è 17.11
        "2024-11-19": 10,  # "–û–±—â–∏–π –≤–µ—Å" –¥–ª—è 19.11
        "2024-11-20": 12,  # "–û–±—â–∏–π –≤–µ—Å" –¥–ª—è 20.11
        "2024-11-22": 14,  # "–û–±—â–∏–π –≤–µ—Å" –¥–ª—è 22.11
        "2024-11-23": 16,  # "–û–±—â–∏–π –≤–µ—Å" –¥–ª—è 23.11
        "2024-11-28": 18,  # "–û–±—â–∏–π –≤–µ—Å" –¥–ª—è 28.11
    }

    imported_stock = await import_stock_from_csv(csv_path, db, date_columns)
    print(f"‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∑–∞–ø–∏—Å–µ–π –æ—Å—Ç–∞—Ç–∫–æ–≤: {imported_stock}\n")

    # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞
    print("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–∞...")
    products = await db.get_all_products()
    latest_stock = await db.get_latest_stock()

    print(f"–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –ë–î: {len(products)}")
    print(f"–¢–æ–≤–∞—Ä–æ–≤ —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏: {len(latest_stock)}\n")

    print("‚úÖ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!")
    print("\nüì± –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞: python main.py")


if __name__ == "__main__":
    asyncio.run(main())
