"""
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start –∏ –∫–Ω–æ–ø–æ–∫ –º–µ–Ω—é
"""
from aiogram import Router, F
from aiogram.filters import Command
from aiogram.types import Message
from keyboards import get_main_menu, get_reports_menu, get_order_menu

router = Router()


@router.message(Command("start"))
async def cmd_start(message: Message, db, user_role: str, is_admin: bool):
    """–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
    await db.add_or_update_user(
        user_id=message.from_user.id,
        username=message.from_user.username,
        first_name=message.from_user.first_name,
        last_name=message.from_user.last_name
    )

    is_private = message.chat.type == 'private'

    if is_private:
        if user_role == 'employee':
            welcome_text = """
üëã <b>–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç —É—á–µ—Ç–∞ WeDrink</b>

–í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –∫–∞–∫ <b>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</b>

üìù <b>–í–≤–µ—Å—Ç–∏ –æ—Å—Ç–∞—Ç–∫–∏</b> - –≤–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É
üì¶ <b>–ú–æ–∏ –∑–∞—è–≤–∫–∏</b> - –ø—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏

–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.
–í—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ.
"""
        else:
            welcome_text = """
üëã <b>–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç —É—á–µ—Ç–∞ WeDrink</b>

–í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –∫–∞–∫ <b>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</b>

üìù <b>–í–≤–µ—Å—Ç–∏ –æ—Å—Ç–∞—Ç–∫–∏</b> - –≤–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ
üìã <b>–ú–æ–¥–µ—Ä–∞—Ü–∏—è</b> - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞—è–≤–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
üì¶ <b>–¢–µ–∫—É—â–∏–µ –æ—Å—Ç–∞—Ç–∫–∏</b> - —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∫–ª–∞–¥–∞
üõí <b>–°–ø–∏—Å–æ–∫ –∑–∞–∫—É–ø–∞</b> - —á—Ç–æ –∑–∞–∫–∞–∑–∞—Ç—å
üí∞ <b>–û—Ç—á–µ—Ç—ã</b> - —Ä–∞—Å—Ö–æ–¥—ã –≤ —Ç–µ–Ω–≥–µ
üìä <b>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</b> - —Ç–æ–ø —Ç–æ–≤–∞—Ä–æ–≤
üë• <b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</b> - –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
"""
    else:
        welcome_text = """
üëã <b>WeDrink –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –≤ –≥—Ä—É–ø–ø–µ!</b>

üìù –î–æ—Å—Ç—É–ø–Ω—ã –∫–æ–º–∞–Ω–¥—ã:
‚Ä¢ –¢–µ–∫—É—â–∏–µ –æ—Å—Ç–∞—Ç–∫–∏
‚Ä¢ –û—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
‚Ä¢ –°–ø–∏—Å–æ–∫ –∑–∞–∫—É–ø–∞

üí° –í–≤–æ–¥ –æ—Å—Ç–∞—Ç–∫–æ–≤ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö.
    """

    await message.answer(welcome_text, reply_markup=get_main_menu(is_private, user_role), parse_mode="HTML")


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
@router.message(F.text == "üõí –°–ø–∏—Å–æ–∫ –∑–∞–∫—É–ø–∞")
async def btn_order(message: Message):
    """–ö–Ω–æ–ø–∫–∞: –°–ø–∏—Å–æ–∫ –∑–∞–∫—É–ø–∞"""
    await message.answer(
        "–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑:",
        reply_markup=get_order_menu()
    )


@router.message(F.text == "üí∞ –û—Ç—á–µ—Ç—ã")
async def btn_reports(message: Message):
    """–ö–Ω–æ–ø–∫–∞: –û—Ç—á–µ—Ç—ã"""
    await message.answer(
        "–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –¥–ª—è –æ—Ç—á–µ—Ç–∞:",
        reply_markup=get_reports_menu()
    )


@router.message(F.text == "‚ÑπÔ∏è –ü–æ–º–æ—â—å")
async def btn_help_menu(message: Message):
    """–ö–Ω–æ–ø–∫–∞: –ü–æ–º–æ—â—å"""
    await cmd_help(message)


# –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
@router.message(F.text == "‚¨ÖÔ∏è –ù–∞–∑–∞–¥")
async def btn_back(message: Message, user_role: str):
    """–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    is_private = message.chat.type == 'private'
    await message.answer("–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:", reply_markup=get_main_menu(is_private, user_role))


@router.message(Command("help"))
async def cmd_help(message: Message, user_role: str = 'employee'):
    """–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞"""
    is_private = message.chat.type == 'private'

    help_text = """
üìñ <b>–ü–û–î–†–û–ë–ù–ê–Ø –°–ü–†–ê–í–ö–ê</b>

<b>1. –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —É—á–µ—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤</b>
üìù –í–≤–æ–¥ –æ—Å—Ç–∞—Ç–∫–æ–≤ - —á–µ—Ä–µ–∑ —É–¥–æ–±–Ω—É—é —Ñ–æ—Ä–º—É (Mini App)
–í–≤–æ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–∞–∫–æ–≤–æ–∫, –±–æ—Ç –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç –≤ –∫–∏–ª–æ–≥—Ä–∞–º–º—ã
üí° –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

<b>2. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞</b>
üõí –°–ø–∏—Å–æ–∫ –∑–∞–∫—É–ø–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –Ω—É–∂–Ω–æ –∑–∞–∫–∞–∑–∞—Ç—å
–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥: 14, 20 –∏–ª–∏ 30 –¥–Ω–µ–π
‚ö†Ô∏è –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ 3-5 –¥–Ω–µ–π!

<b>3. –û—Ç—á–µ—Ç—ã</b>
üí∞ –û—Ç—á–µ—Ç—ã ‚Üí –í—á–µ—Ä–∞ - —Ä–∞—Å—Ö–æ–¥ –∑–∞ –≤—á–µ—Ä–∞ –≤ ‚Ç∏
üí∞ –û—Ç—á–µ—Ç—ã ‚Üí –ù–µ–¥–µ–ª—è - –æ–±—â–∏–π —Ä–∞—Å—Ö–æ–¥ + —Ç–æ–ø —Ç–æ–≤–∞—Ä–æ–≤

<b>4. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</b>
üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ - –∫–∞–∫–∏–µ —Ç–æ–≤–∞—Ä—ã —Ä–∞—Å—Ö–æ–¥—É—é—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º –∑–∞–ø–∞—Å–∞–º

<b>5. –¢–µ–∫—É—â–∏–µ –æ—Å—Ç–∞—Ç–∫–∏</b>
üì¶ –¢–µ–∫—É—â–∏–µ –æ—Å—Ç–∞—Ç–∫–∏ - —á—Ç–æ —Å–µ–π—á–∞—Å –Ω–∞ —Å–∫–ª–∞–¥–µ

üí° <b>–°–æ–≤–µ—Ç:</b> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞!
    """

    if not is_private:
        help_text += "\n\n‚ö†Ô∏è <b>–†–∞–±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ:</b> –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ (Mini App) –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö —Å –±–æ—Ç–æ–º."

    await message.answer(help_text, reply_markup=get_main_menu(is_private, user_role), parse_mode="HTML")


@router.message(Command("chatid"))
async def cmd_chatid(message: Message):
    """–ü–æ–∫–∞–∑–∞—Ç—å Chat ID —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Ç–∞"""
    chat_id = message.chat.id
    chat_type = message.chat.type

    if chat_type == "private":
        response = (
            f"üîë <b>Chat ID —ç—Ç–æ–≥–æ —á–∞—Ç–∞:</b> <code>{chat_id}</code>\n\n"
            f"‚ö†Ô∏è –≠—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç. –î–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –Ω—É–∂–µ–Ω ID <b>–≥—Ä—É–ø–ø—ã</b>.\n"
            f"–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /chatid –≤ –≤–∞—à–µ–π –≥—Ä—É–ø–ø–µ 'WeDrink –∑–∞–∫—É–ø –±–æ—Ç'."
        )
    else:
        chat_title = message.chat.title or "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞"
        response = (
            f"üîë <b>Chat ID —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã:</b> <code>{chat_id}</code>\n\n"
            f"üì± –ù–∞–∑–≤–∞–Ω–∏–µ: {chat_title}\n"
            f"üë• –¢–∏–ø: {chat_type}\n\n"
            f"‚úÖ –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç ID –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è <code>REMINDER_CHAT_ID</code> –Ω–∞ Railway.\n\n"
            f"üí° –ß—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å - –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ ID –≤—ã—à–µ."
        )

    await message.answer(response, parse_mode="HTML")
