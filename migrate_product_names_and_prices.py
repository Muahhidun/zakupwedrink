#!/usr/bin/env python3
"""
–ú–∏–≥—Ä–∞—Ü–∏—è: –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–∑–∏—Ü–∏–π, —É–¥–∞–ª–µ–Ω–∏–µ –û—Ä–µ–æ.

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç name_internal –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–¥–æ–±–∞–≤–ª—è–µ—Ç –≤–µ—Å*–∫–æ–ª-–≤–æ)
2. –û–±–Ω–æ–≤–ª—è–µ—Ç —Ü–µ–Ω—ã –Ω–∞ —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–æ—Ä–æ–∂–∞–ª–∏
3. –î–æ–±–∞–≤–ª—è–µ—Ç 4 –Ω–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏
4. –£–¥–∞–ª—è–µ—Ç –ø–æ–∑–∏—Ü–∏—é "–û—Ä–µ–æ –∫—Ä–æ—à–∫–∞ –¥–ª—è —Ç–æ–ø–∏–Ω–≥–∞"
"""
import asyncio
import os
from database_pg import DatabasePG
from dotenv import load_dotenv

load_dotenv()

# =============================================================
# 1. –ü–ï–†–ï–ò–ú–ï–ù–û–í–ê–ù–ò–Ø: old_name -> new_name
# =============================================================
RENAMES = {
    # –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
    "–ú–∞–Ω–≥–æ–≤–æ–µ –ø—é—Ä–µ 1,2 –∫–≥": "–ú–∞–Ω–≥–æ–≤–æ–µ –ø—é—Ä–µ 1.2–∫–≥*12—à—Ç",
    "–ü–µ—Ä—Å–∏–∫–æ–≤–æ–µ –ø—é—Ä–µ 1,2 –∫–≥": "–ü–µ—Ä—Å–∏–∫–æ–≤–æ–µ –ø—é—Ä–µ 1.2–∫–≥*12—à—Ç",
    "–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç –Ω–∞–ø–∏—Ç–∫–∞ —Å –∫—É—Å–æ—á–∫–∞–º–∏ –∞–ø–µ–ª—å—Å–∏–Ω–∞ 2,6 –∫–≥": "–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç 2.6–∫–≥*8—à—Ç",
    "–ú–∞–ª–∏–Ω–∞ —Å–æ–∫ 2,6 –∫–≥": "–ú–∞–ª–∏–Ω–∞ —Å–æ–∫ 2.6–∫–≥*8—à—Ç",
    "–í–∏–Ω–æ–≥—Ä–∞–¥–Ω—ã–π —Å–æ–∫ 2,6 –∫–≥": "–í–∏–Ω–æ–≥—Ä–∞–¥–Ω—ã–π —Å–æ–∫ 2.6–∫–≥*8—à—Ç",
    "–í–∏–Ω–æ–≥—Ä–∞–¥ –∫–æ–Ω—Å–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–π 850 –≥": "–í–∏–Ω–æ–≥—Ä–∞–¥ –∫–æ–Ω—Å–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–π 0.85–∫–≥*12—à—Ç",
    "–ì—Ä–µ–π–ø—Ñ—Ä—É—Ç 850 –≥": "–ì—Ä–µ–π–ø—Ñ—Ä—É—Ç 0.85–∫–≥*12—à—Ç",
    "–õ–∞—Ç—Ç–µ 1 –∫–≥": "–õ–∞—Ç—Ç–µ 1–∫–≥*20—à—Ç",
    "–Ø–Ω—á–∂–∏ –ì–∞–Ω–ª—É 1 –∫–≥": "–Ø–Ω—á–∂–∏ –ì–∞–Ω–ª—É 1–∫–≥*20—à—Ç",
    "–Ø–Ω—á–∂–∏ –ì–∞–Ω–ª—É 1 –∫–≥ ": "–Ø–Ω—á–∂–∏ –ì–∞–Ω–ª—É 1–∫–≥*20—à—Ç",  # —Å –ø—Ä–æ–±–µ–ª–æ–º –≤ –∫–æ–Ω—Ü–µ
    "–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç —Å–æ–∫–∞ –º–∞—Ä–∞–∫—É–π–∏ 2 –∫–≥": "–ú–∞—Ä–∞–∫—É–π—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç 2–∫–≥*6—à—Ç",
    "–°–∏—Ä–æ–ø –∏–∑ —Ñ—Ä—É–∫—Ç–æ–≤–æ–≥–æ —Å–æ–∫–∞ 12,5 –∫–≥": "–°–∏—Ä–æ–ø —Ñ—Ä—É–∫—Ç–æ–≤—ã–π 12.5–∫–≥*2—à—Ç",
    "–ö–æ–∫–æ—Å–æ–≤—ã–µ –∫—É—Å–æ—á–∫–∏ 2,5 –∫–≥": "–ö–æ–∫–æ—Å–æ–≤—ã–µ –∫—É—Å–æ—á–∫–∏ 2.5–∫–≥*8—à—Ç",
    "–¢–∞–ø–∏–æ–∫–∞ 1 –∫–≥": "–¢–∞–ø–∏–æ–∫–∞ 1–∫–≥*20—à—Ç",
    "–•—Ä—É—Å—Ç—è—â–∏–µ —Ä–æ–∂–∫–∏ –ø–æ 400 —à—Ç—É–∫": "–•—Ä—É—Å—Ç—è—â–∏–µ —Ä–æ–∂–∫–∏ 400—à—Ç",
    "–ü–æ—Ä–æ—à–æ–∫ —Å–æ –≤–∫—É—Å–æ–º –º–æ–ª–æ—á–Ω–æ–≥–æ –∫–æ–∫—Ç–µ–π–ª—è (—Å–ª–∏–≤–æ—á–Ω—ã–π)  3–∫–≥": "–ú–æ—Ä–æ–∂–µ–Ω–æ–µ (—Å–ª–∏–≤–æ—á–Ω–æ–µ) 3–∫–≥*8—à—Ç",
    "–ü–æ—Ä–æ—à–æ–∫ —Å–æ –≤–∫—É—Å–æ–º –º–æ–ª–æ—á–Ω–æ–≥–æ –∫–æ–∫—Ç–µ–π–ª—è (—Å–ª–∏–≤–æ—á–Ω—ã–π) 3–∫–≥": "–ú–æ—Ä–æ–∂–µ–Ω–æ–µ (—Å–ª–∏–≤–æ—á–Ω–æ–µ) 3–∫–≥*8—à—Ç",
    "–ü–æ—Ä–æ—à–æ–∫ —Å–æ –≤–∫—É—Å–æ–º –º–æ–ª–æ—á–Ω–æ–≥–æ –∫–æ–∫—Ç–µ–π–ª—è ( —à–æ–∫–æ–ª–∞–¥–Ω—ã–π) 3–∫–≥": "–ú–æ—Ä–æ–∂–µ–Ω–æ–µ (—à–æ–∫–æ–ª–∞–¥–Ω–æ–µ) 3–∫–≥*8—à—Ç",
    "–ü–æ—Ä–æ—à–æ–∫ —Å–æ –≤–∫—É—Å–æ–º –º–æ–ª–æ—á–Ω–æ–≥–æ –∫–æ–∫—Ç–µ–π–ª—è (—à–æ–∫–æ–ª–∞–¥–Ω—ã–π)  3–∫–≥": "–ú–æ—Ä–æ–∂–µ–Ω–æ–µ (—à–æ–∫–æ–ª–∞–¥–Ω–æ–µ) 3–∫–≥*8—à—Ç",
    "–ü–æ—Ä–æ—à–æ–∫ —Å–æ –≤–∫—É—Å–æ–º –º–æ–ª–æ—á–Ω–æ–≥–æ –∫–æ–∫—Ç–µ–π–ª—è (—à–æ–∫–æ–ª–∞–¥–Ω—ã–π) 3–∫–≥": "–ú–æ—Ä–æ–∂–µ–Ω–æ–µ (—à–æ–∫–æ–ª–∞–¥–Ω–æ–µ) 3–∫–≥*8—à—Ç",
    "–ú–∞—Ç—á–∞ –º–æ—Ä–æ–∂–µ–Ω–æ–µ": "–ú–æ—Ä–æ–∂–µ–Ω–æ–µ (–º–∞—Ç—á–∞) 3–∫–≥*8—à—Ç",
    "–ö–æ–º–ø–∞–Ω—å–æ–Ω –¥–ª—è —á–∞—è —Å –º–æ–ª–æ–∫–æ–º 3 –∫–≥": "–ö–æ–º–ø–∞–Ω—å–æ–Ω –¥–ª—è —á–∞—è 3–∫–≥*8—à—Ç",
    "–ö–æ–º–ø–∞–Ω—å–æ–Ω –¥–ª—è —á–∞—è —Å –º–æ–ª–æ–∫–æ–º 3 –∫–≥ ": "–ö–æ–º–ø–∞–Ω—å–æ–Ω –¥–ª—è —á–∞—è 3–∫–≥*8—à—Ç",  # —Å –ø—Ä–æ–±–µ–ª–æ–º
    "–§—Ä—É—Ç–æ–≤—ã–π –º–µ–¥ 5.5–∫–≥": "–§—Ä—É–∫—Ç–æ–≤—ã–π –º–µ–¥ 5.5–∫–≥*4—à—Ç",
    "–ü–æ—Ä–æ—à–æ–∫ –¥–ª—è –∫–∞—Ä–∞–º–µ–ª—å–Ω–æ–≥–æ –ø—É–¥–∏–Ω–≥–∞ 1 –∫–≥": "–ü–æ—Ä–æ—à–æ–∫ –¥–ª—è –ø—É–¥–∏–Ω–≥–∞ 1–∫–≥*20—à—Ç",
    "–ß–µ—Ä–Ω—ã–π —Å–∞—Ö–∞—Ä 2,5 –∫–≥": "–ß–µ—Ä–Ω—ã–π —Å–∞—Ö–∞—Ä 2.5–∫–≥*8—à—Ç",
    "–®–æ–∫–æ–ª–∞–¥–Ω—ã–π —Å–∏—Ä–æ–ø 2,5 –∫–≥": "–®–æ–∫–æ–ª–∞–¥–Ω—ã–π —Å–∏—Ä–æ–ø 2.5–∫–≥*8—à—Ç",
    "–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç –∫–ª—É–±–Ω–∏—á–Ω–æ–≥–æ —Å–æ–∫–∞ 2 –∫–≥": "–ö–ª—É–±–Ω–∏—á–Ω—ã–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç 2–∫–≥*6—à—Ç",
    "–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç –Ω–∞–ø–∏—Ç–∫–∞ —Å –∫—É—Å–æ—á–∫–∞–º–∏ —á–µ—Ä–Ω–∏–∫–∏ 2 –∫–≥": "–ß–µ—Ä–Ω–∏—á–Ω—ã–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç 2–∫–≥*6—à—Ç",
    "–ü–µ—Ä—Å–∏–∫–æ–≤–æ–µ –∂–µ–ª–µ 1 –ª": "–ü–µ—Ä—Å–∏–∫–æ–≤–æ–µ –∂–µ–ª–µ 1–ª*10—à—Ç",
    "–§–∞—Å–æ–ª—å 900 –≥": "–§–∞—Å–æ–ª—å 0.9–∫–≥*12—à—Ç",
    "–§–∞—Å–æ–ª—å 900 –≥ ": "–§–∞—Å–æ–ª—å 0.9–∫–≥*12—à—Ç",  # —Å –ø—Ä–æ–±–µ–ª–æ–º
    "–ö–∞–ø–ø—É—á–∏–Ω–æ –ø–æ—Ä–æ—à–æ–∫": "–ö–∞–ø–ø—É—á–∏–Ω–æ 1–∫–≥*20—à—Ç",
    "–ñ–∞—Å–º–∏–Ω–æ–≤—ã–π —á–∞–π": "–ñ–∞—Å–º–∏–Ω–æ–≤—ã–π —á–∞–π 50–≥*160—à—Ç",
    "–ß–µ—Ä–Ω—ã–π —á–∞–π": "–ß–µ—Ä–Ω—ã–π —á–∞–π 100–≥*120—à—Ç",
    # –£–ø–∞–∫–æ–≤–∫–∞
    "–°—Ç–∞–∫–∞–Ω 500": "–°—Ç–∞–∫–∞–Ω 500 (1000—à—Ç/–∫–æ—Ä)",
    "–°—Ç–∞–∫–∞–Ω 700": "–°—Ç–∞–∫–∞–Ω 700 (1000—à—Ç/–∫–æ—Ä)",
    "–°—Ç–∞–∫–∞–Ω –±–æ–ª—å—à–æ–π 900–º–ª": "–°—Ç–∞–∫–∞–Ω –±–æ–ª—å—à–æ–π 900–º–ª (200—à—Ç/–∫–æ—Ä)",
    "–°—Ç–∞–∫–∞–Ω U": "–°—Ç–∞–∫–∞–Ω U (1000—à—Ç/–∫–æ—Ä)",
    "–¢–æ–ª—Å—Ç—ã–µ –±—É–º–∞–∂–Ω—ã–µ —Ç—Ä—É–±–æ—á–∫–∏": "–¢–æ–ª—Å—Ç—ã–µ —Ç—Ä—É–±–æ—á–∫–∏ (4000—à—Ç/–∫–æ—Ä)",
    "–¢–æ–Ω–∫–∏–µ –±—É–º–∞–∂–Ω—ã–µ —Ç—Ä—É–±–æ—á–∫–∏": "–¢–æ–Ω–∫–∏–µ —Ç—Ä—É–±–æ—á–∫–∏ (5000—à—Ç/–∫–æ—Ä)",
    "–ö—Ä—ã—à–∫–∞ –∫—É–ø–æ–ª—å–Ω–∞—è 90": "–ö—Ä—ã—à–∫–∞ –∫—É–ø–æ–ª—å–Ω–∞—è (2000—à—Ç/–∫–æ—Ä)",
    "–±–æ–ª—å—à–∞—è –¥–ª–∏–Ω–Ω–∞—è –ª–æ–∂–∫–∞": "–õ–æ–∂–∫–∞ –±–æ–ª—å—à–∞—è (—á–µ—Ä–Ω–∞—è) (2000—à—Ç/–∫–æ—Ä)",
    "–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–∂–∫–∞ (–º–∞–ª–µ–Ω—å–∫–∞—è, –¥–µ–≥—É—Å—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è)": "–õ–æ–∂–∫–∞ –º–∞–ª–µ–Ω—å–∫–∞—è (–±–µ–ª–∞—è) (1000—à—Ç/–∫–æ—Ä)",
    "–ü–ª—ë–Ω–∫–∞ –¥–ª—è –∑–∞–ø–∞–π–∫–∏ —Å—Ç–∞–∫–∞–Ω–æ–≤": "–ü–ª—ë–Ω–∫–∞ –¥–ª—è –∑–∞–ø–∞–π–∫–∏ (12—Ä—É–ª/–∫–æ—Ä)",
    "–ü–∞–∫–µ—Ç –¥–ª—è –æ–¥–Ω–æ–π —á–∞—à–∫–∏": "–ü–∞–∫–µ—Ç 1 —á–∞—à–∫–∞ (10000—à—Ç/–∫–æ—Ä)",
    # –ü–∞–∫–µ—Ç –¥–ª—è –¥–≤—É—Ö —á–∞—à–µ–∫ ‚Äî —Ç–æ—Ç –∂–µ name_internal "–ü–∞–∫–µ—Ç –¥–ª—è –æ–¥–Ω–æ–π —á–∞—à–∫–∏" –≤ CSV, –Ω–æ –¥—Ä—É–≥–æ–π ID
    "–ü–∞–∫–µ—Ç –¥–ª—è —á–µ—Ç—ã—Ä—ë—Ö —á–∞—à–µ–∫": "–ü–∞–∫–µ—Ç 4 —á–∞—à–∫–∏ (3000—à—Ç/–∫–æ—Ä)",
    "–ë—É–º–∞–∂–Ω—ã–π —Å—Ç–∞–∫–∞–Ω": "–ë—É–º–∞–∂–Ω—ã–π —Å—Ç–∞–∫–∞–Ω (500—à—Ç/–∫–æ—Ä)",
    "–ö—Ä—ã—à–∫–∞ 90 –ø–ª–∞—Å—Ç–∏–∫ –¥–ª—è –±—É–º–∞–∂–Ω–æ–≥–æ —Å—Ç–∞–∫–∞–Ω–∞": "–ö—Ä—ã—à–∫–∞ 90 –ø–ª–∞—Å—Ç–∏–∫ (1000—à—Ç/–∫–æ—Ä)",
}

# =============================================================
# 2. –û–ë–ù–û–í–õ–ï–ù–ò–ï –¶–ï–ù: name_internal (–Ω–æ–≤—ã–π) -> –Ω–æ–≤–∞—è —Ü–µ–Ω–∞
# =============================================================
PRICE_UPDATES = {
    "–ö–æ–∫–æ—Å–æ–≤—ã–µ –∫—É—Å–æ—á–∫–∏ 2.5–∫–≥*8—à—Ç": 15500.0,
    "–¢–∞–ø–∏–æ–∫–∞ 1–∫–≥*20—à—Ç": 25000.0,
    "–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç 2.6–∫–≥*8—à—Ç": 50000.0,
    "–í–∏–Ω–æ–≥—Ä–∞–¥–Ω—ã–π —Å–æ–∫ 2.6–∫–≥*8—à—Ç": 45000.0,
    "–õ–æ–∂–∫–∞ –±–æ–ª—å—à–∞—è (—á–µ—Ä–Ω–∞—è) (2000—à—Ç/–∫–æ—Ä)": 30000.0,
    "–•—Ä—É—Å—Ç—è—â–∏–µ —Ä–æ–∂–∫–∏ 400—à—Ç": 10937.5,  # –ü–∞–ª–ª–µ—Ç–∞ 175000‚Ç∏ / 16 –∫–æ—Ä–æ–±–æ–∫
    "–ú–æ—Ä–æ–∂–µ–Ω–æ–µ (—à–æ–∫–æ–ª–∞–¥–Ω–æ–µ) 3–∫–≥*8—à—Ç": 71250.0,
}

# =============================================================
# 3. –ù–û–í–´–ï –ü–û–ó–ò–¶–ò–ò
# =============================================================
NEW_PRODUCTS = [
    {
        "name_chinese": "Êô∂ÁêÉ",
        "name_russian": "–ñ–µ–ª–µ —à–∞—Ä–ª–∞—Ä—ã (–∫—Ä–∏—Å—Ç–∞–ª–ª —à–∞—Ä–ª–∞—Ä)",
        "name_internal": "–ñ–µ–ª–µ —à–∞—Ä—ã 1–∫–≥*20—à—Ç",
        "package_weight": 1.0,
        "units_per_box": 20,
        "price_per_box": 25000.0,
        "unit": "–∫–≥",
    },
    {
        "name_chinese": "ÂíñÂï°Ë±Ü",
        "name_russian": "–ö–æ—Ñ–µ –¥”ô–Ω–¥–µ—Ä—ñ (–∫–æ—Ñ–µ–π–Ω—ã–µ –∑—ë—Ä–Ω–∞)",
        "name_internal": "–ö–æ—Ñ–µ –∑–µ—Ä–Ω–∞ 500–≥*20—à—Ç",
        "package_weight": 0.5,
        "units_per_box": 20,
        "price_per_box": 115000.0,
        "unit": "–∫–≥",
    },
    {
        "name_chinese": "Ëõã‰ªîÁ≤â",
        "name_russian": "–ñ“±–º—ã—Ä—Ç“õ–∞–ª—ã –≤–∞—Ñ–ª–∏ “±–Ω—Ç–∞“ì—ã (–ø–æ—Ä–æ—à–æ–∫ –¥–ª—è –≤–∞—Ñ–µ–ª—å)",
        "name_internal": "–ü–æ—Ä–æ—à–æ–∫ –¥–ª—è –≤–∞—Ñ–µ–ª—å 1.5–∫–≥*8—à—Ç",
        "package_weight": 1.5,
        "units_per_box": 8,
        "price_per_box": 22000.0,
        "unit": "–∫–≥",
    },
    {
        "name_chinese": "Ê§∞‰π≥",
        "name_russian": "–ö–æ–∫–æ—Å —Å“Ø—Ç—ñ (–∫–æ–∫–æ—Å–æ–≤–æ–µ –º–æ–ª–æ–∫–æ)",
        "name_internal": "–ö–æ–∫–æ—Å–æ–≤–æ–µ –º–æ–ª–æ–∫–æ 1–ª*12—à—Ç",
        "package_weight": 1.0,
        "units_per_box": 12,
        "price_per_box": 13500.0,
        "unit": "–ª",
    },
]

# =============================================================
# 4. –£–î–ê–õ–ï–ù–ò–ï
# =============================================================
DELETE_PRODUCTS = [
    "–û—Ä–µ–æ –∫—Ä–æ—à–∫–∞ –¥–ª—è —Ç–æ–ø–∏–Ω–≥–∞",
]


async def main():
    database_url = os.getenv('DATABASE_URL')
    if not database_url:
        print("‚ùå DATABASE_URL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        return

    db = DatabasePG(database_url)
    await db.init_db()
    print("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ PostgreSQL\n")

    async with db.pool.acquire() as conn:
        products = await conn.fetch("SELECT id, name_internal FROM products ORDER BY id")
        existing = {p['name_internal']: p['id'] for p in products}
        print(f"üì¶ –ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –ë–î: {len(existing)}\n")

        # ---- 1. –ü–ï–†–ï–ò–ú–ï–ù–û–í–ê–ù–ò–Ø ----
        print("=" * 50)
        print("1. –ü–ï–†–ï–ò–ú–ï–ù–û–í–ê–ù–ò–ï –¢–û–í–ê–†–û–í")
        print("=" * 50)
        renamed = 0
        for old_name, new_name in RENAMES.items():
            if old_name in existing:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–≤–æ–µ –∏–º—è –µ—â—ë –Ω–µ –∑–∞–Ω—è—Ç–æ –¥—Ä—É–≥–∏–º —Ç–æ–≤–∞—Ä–æ–º
                if new_name in existing and existing[new_name] != existing[old_name]:
                    print(f"‚ö†Ô∏è  –ö–æ–Ω—Ñ–ª–∏–∫—Ç: '{new_name}' —É–∂–µ –∑–∞–Ω—è—Ç–æ (ID {existing[new_name]}). –ü—Ä–æ–ø—É—Å–∫–∞—é '{old_name}'")
                    continue
                await conn.execute(
                    "UPDATE products SET name_internal = $1 WHERE id = $2",
                    new_name, existing[old_name]
                )
                print(f"‚úÖ {old_name} ‚Üí {new_name}")
                # –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–ø–ø–∏–Ω–≥
                pid = existing.pop(old_name)
                existing[new_name] = pid
                renamed += 1
            else:
                # –ú–æ–∂–µ—Ç —É–∂–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω
                if new_name in existing:
                    pass  # –£–∂–µ –æ–∫
                else:
                    print(f"‚ö†Ô∏è  –ù–µ –Ω–∞–π–¥–µ–Ω: '{old_name}'")
        print(f"\nüìù –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ: {renamed}\n")

        # –û—Ç–¥–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–∫–µ—Ç–∞ –¥–ª—è 2 —á–∞—à–µ–∫ (–¥—É–±–ª—å name_internal)
        # –ò—â–µ–º –ø–æ chinese name –∏–ª–∏ –ø–æ —Ü–µ–Ω–µ
        double_bag = await conn.fetchrow("""
            SELECT id, name_internal FROM products
            WHERE name_chinese LIKE '%ÂèåÊùØË¢ã%' OR name_russian LIKE '%–¥–≤–æ–π–Ω%'
        """)
        if double_bag and double_bag['name_internal'] != "–ü–∞–∫–µ—Ç 2 —á–∞—à–∫–∏ (5000—à—Ç/–∫–æ—Ä)":
            await conn.execute(
                "UPDATE products SET name_internal = $1 WHERE id = $2",
                "–ü–∞–∫–µ—Ç 2 —á–∞—à–∫–∏ (5000—à—Ç/–∫–æ—Ä)", double_bag['id']
            )
            print(f"‚úÖ –ü–∞–∫–µ—Ç –¥–≤–æ–π–Ω–æ–π: {double_bag['name_internal']} ‚Üí –ü–∞–∫–µ—Ç 2 —á–∞—à–∫–∏ (5000—à—Ç/–∫–æ—Ä)")
            existing["–ü–∞–∫–µ—Ç 2 —á–∞—à–∫–∏ (5000—à—Ç/–∫–æ—Ä)"] = double_bag['id']

        # ---- 2. –û–ë–ù–û–í–õ–ï–ù–ò–ï –¶–ï–ù ----
        print("\n" + "=" * 50)
        print("2. –û–ë–ù–û–í–õ–ï–ù–ò–ï –¶–ï–ù")
        print("=" * 50)
        prices_updated = 0
        for name, new_price in PRICE_UPDATES.items():
            if name in existing:
                old_price = await conn.fetchval(
                    "SELECT price_per_box FROM products WHERE id = $1",
                    existing[name]
                )
                if old_price != new_price:
                    await conn.execute(
                        "UPDATE products SET price_per_box = $1 WHERE id = $2",
                        new_price, existing[name]
                    )
                    print(f"‚úÖ {name}: {old_price:,.0f} ‚Üí {new_price:,.0f} ‚Ç∏")
                    prices_updated += 1
                else:
                    print(f"   {name}: —Ü–µ–Ω–∞ —É–∂–µ –∞–∫—Ç—É–∞–ª—å–Ω–∞ ({new_price:,.0f} ‚Ç∏)")
            else:
                print(f"‚ö†Ô∏è  –ù–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã: '{name}'")
        print(f"\nüí∞ –û–±–Ω–æ–≤–ª–µ–Ω–æ —Ü–µ–Ω: {prices_updated}\n")

        # ---- 3. –ù–û–í–´–ï –ü–û–ó–ò–¶–ò–ò ----
        print("=" * 50)
        print("3. –î–û–ë–ê–í–õ–ï–ù–ò–ï –ù–û–í–´–• –ü–û–ó–ò–¶–ò–ô")
        print("=" * 50)
        added = 0
        for product in NEW_PRODUCTS:
            if product["name_internal"] in existing:
                print(f"   –£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {product['name_internal']}")
                continue
            box_weight = product["package_weight"] * product["units_per_box"]
            pid = await conn.fetchval("""
                INSERT INTO products
                (name_chinese, name_russian, name_internal, package_weight,
                 units_per_box, box_weight, price_per_box, unit)
                VALUES ($1, $2, $3, $4, $5, $6, $7, $8)
                RETURNING id
            """,
                product["name_chinese"],
                product["name_russian"],
                product["name_internal"],
                product["package_weight"],
                product["units_per_box"],
                box_weight,
                product["price_per_box"],
                product["unit"],
            )
            print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω: {product['name_internal']} (ID: {pid})")
            existing[product["name_internal"]] = pid
            added += 1
        print(f"\n‚ûï –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–∑–∏—Ü–∏–π: {added}\n")

        # ---- 4. –£–î–ê–õ–ï–ù–ò–ï –û–†–ï–û ----
        print("=" * 50)
        print("4. –£–î–ê–õ–ï–ù–ò–ï –ù–ï–ê–ö–¢–£–ê–õ–¨–ù–´–• –ü–û–ó–ò–¶–ò–ô")
        print("=" * 50)
        deleted = 0
        for name in DELETE_PRODUCTS:
            if name not in existing:
                print(f"   –ù–µ –Ω–∞–π–¥–µ–Ω (–≤–æ–∑–º–æ–∂–Ω–æ —É–∂–µ —É–¥–∞–ª—ë–Ω): '{name}'")
                continue

            pid = existing[name]
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
            stock_count = await conn.fetchval(
                "SELECT COUNT(*) FROM stock WHERE product_id = $1", pid
            )
            supply_count = await conn.fetchval(
                "SELECT COUNT(*) FROM supplies WHERE product_id = $1", pid
            )
            order_count = await conn.fetchval(
                "SELECT COUNT(*) FROM pending_order_items WHERE product_id = $1", pid
            )

            if stock_count > 0 or supply_count > 0 or order_count > 0:
                print(f"‚ö†Ô∏è  '{name}' –∏–º–µ–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ "
                      f"(stock: {stock_count}, supplies: {supply_count}, orders: {order_count}). "
                      f"–£–¥–∞–ª—è—é —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏...")
                await conn.execute("DELETE FROM pending_order_items WHERE product_id = $1", pid)
                await conn.execute("DELETE FROM stock WHERE product_id = $1", pid)
                await conn.execute("DELETE FROM supplies WHERE product_id = $1", pid)

            await conn.execute("DELETE FROM products WHERE id = $1", pid)
            print(f"‚úÖ –£–¥–∞–ª—ë–Ω: {name} (ID: {pid})")
            del existing[name]
            deleted += 1
        print(f"\nüóëÔ∏è  –£–¥–∞–ª–µ–Ω–æ –ø–æ–∑–∏—Ü–∏–π: {deleted}\n")

        # ---- –ò–¢–û–ì ----
        final_count = await conn.fetchval("SELECT COUNT(*) FROM products")
        print("=" * 50)
        print(f"–ò–¢–û–ì–û: {final_count} —Ç–æ–≤–∞—Ä–æ–≤ –≤ –±–∞–∑–µ")
        print("=" * 50)

    await db.close()


if __name__ == '__main__':
    asyncio.run(main())
